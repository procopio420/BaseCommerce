{% if flash_message %}
<div class="flash flash-{{ flash_type or 'info' }}" hx-swap-oob="beforeend:#flash-container">
    {{ flash_message }}
    <button onclick="this.parentElement.remove()" class="flash-close">&times;</button>
</div>
{% endif %}

{% if pedidos %}
<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Número</th>
                <th>Cliente</th>
                <th>Total</th>
                <th>Status</th>
                <th>Data</th>
                <th style="text-align: right;">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr id="pedido-{{ pedido.id }}" 
                style="cursor: pointer;"
                hx-get="/web/pedidos/{{ pedido.id }}/details"
                hx-target="#pedido-details-content"
                hx-swap="innerHTML">
                <td>
                    <span style="font-family: monospace; font-weight: var(--font-weight-medium);">{{ pedido.numero or pedido.id|string|truncate(8, True, '') }}</span>
                </td>
                <td>{{ pedido.cliente.nome if pedido.cliente else '-' }}</td>
                <td>R$ {{ "%.2f"|format(pedido.valor_total or 0) }}</td>
                <td>
                    <span class="badge badge-{{ pedido.status }}">{{ pedido.status|replace('_', ' ')|title }}</span>
                </td>
                <td class="text-muted">{{ pedido.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                <td style="text-align: right;">
                    <div class="actions">
                        {% if pedido.status == 'pendente' %}
                        <button 
                            class="btn btn-primary btn-sm"
                            hx-post="/web/pedidos/{{ pedido.id }}/update-status"
                            hx-vals='{"status": "em_preparacao"}'
                            hx-target="#pedidos-table"
                            hx-swap="innerHTML"
                            onclick="event.stopPropagation()"
                        >
                            Em Preparação
                        </button>
                        {% elif pedido.status == 'em_preparacao' %}
                        <button 
                            class="btn btn-primary btn-sm"
                            hx-post="/web/pedidos/{{ pedido.id }}/update-status"
                            hx-vals='{"status": "saiu_entrega"}'
                            hx-target="#pedidos-table"
                            hx-swap="innerHTML"
                            onclick="event.stopPropagation()"
                        >
                            Saiu para Entrega
                        </button>
                        {% elif pedido.status == 'saiu_entrega' %}
                        <button 
                            class="btn btn-success btn-sm"
                            hx-post="/web/pedidos/{{ pedido.id }}/update-status"
                            hx-vals='{"status": "entregue"}'
                            hx-target="#pedidos-table"
                            hx-swap="innerHTML"
                            hx-confirm="Confirmar entrega deste pedido?"
                            onclick="event.stopPropagation()"
                        >
                            Marcar como Entregue
                        </button>
                        {% endif %}
                        {% if pedido.status not in ['entregue', 'cancelado'] %}
                        <button 
                            class="btn btn-outline btn-sm"
                            hx-post="/web/pedidos/{{ pedido.id }}/cancelar"
                            hx-target="#pedidos-table"
                            hx-swap="innerHTML"
                            hx-confirm="Tem certeza que deseja cancelar este pedido?"
                            onclick="event.stopPropagation()"
                        >
                            Cancelar
                        </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% if total_pages and total_pages > 1 %}
{% set target_id = "pedidos-table" %}
{% set url_path = "/web/pedidos/table" %}
{% include "partials/pagination_offset.html" %}
{% endif %}
{% else %}
<div class="empty-state">
    <div class="empty-state-title">Nenhum pedido encontrado</div>
    <div class="empty-state-message">Ainda não há pedidos registrados.</div>
    <div class="empty-state-action">
        <a href="/web/cotacoes" class="btn btn-primary">Ver cotações</a>
    </div>
</div>
{% endif %}
